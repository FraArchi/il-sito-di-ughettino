
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - La Cuccia di Ugo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem; }
        .header h1 { display: inline-block; font-size: 1.8rem; }
        .header .logo { display: inline-block; font-size: 2rem; margin-right: 0.5rem; }
        .nav { display: inline-block; float: right; }
        .nav a { color: white; text-decoration: none; margin: 0 1rem; padding: 0.5rem; border-radius: 4px; transition: background 0.3s; }
        .nav a:hover { background: rgba(255,255,255,0.2); }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: white; padding: 1.5rem; margin: 1rem 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .metric-card { text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .metric-value { font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem; }
        .metric-label { font-size: 1rem; opacity: 0.9; }
        .btn { background: #3498db; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; margin: 0.25rem; transition: background 0.3s; }
        .btn:hover { background: #2980b9; }
        .btn-success { background: #27ae60; }
        .btn-success:hover { background: #219a52; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .btn-warning { background: #f39c12; }
        .btn-warning:hover { background: #d68910; }
        .table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .table th, .table td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #ddd; }
        .table th { background: #f8f9fa; font-weight: bold; color: #2c3e50; }
        .table tr:hover { background: #f8f9fa; }
        .status-success { color: #27ae60; font-weight: bold; }
        .status-pending { color: #f39c12; font-weight: bold; }
        .status-error { color: #e74c3c; font-weight: bold; }
        .alert { padding: 1rem; border-radius: 4px; margin: 1rem 0; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .footer { text-align: center; margin-top: 3rem; padding: 2rem; color: #7f8c8d; }
    </style>
</head>
<body>
    <div class="header">
        <span class="logo">üêï</span>
        <h1>La Cuccia di Ugo - Daily Wisdom</h1>
        <nav class="nav">
            <a href="/">üè† Dashboard</a>
            <a href="/wisdom">üìù Saggezze</a>
            <a href="/analytics">üìä Analytics</a>
            <a href="/social">üì± Social Media</a>
        </nav>
    </div>
    
    <div class="container">
        {% block content %}{% endblock %}
    </div>
    
    <div class="footer">
        <p>üêï La Cuccia di Ugo - Daily Wisdom System v1.0</p>
        <p>Made with ‚ù§Ô∏è for Ugo and his daily wisdom</p>
    </div>
    
    <script>
        // Funzioni JavaScript per interattivit√†
        async function generateWisdom() {
            const button = event.target;
            button.disabled = true;
            button.textContent = '‚è≥ Generando...';
            
            try {
                const response = await fetch('/api/generate-wisdom', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    showAlert('Nuova saggezza generata con successo! üéâ', 'success');
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showAlert('Errore nella generazione: ' + (result.error || 'Errore sconosciuto'), 'error');
                }
            } catch (error) {
                showAlert('Errore di connessione: ' + error.message, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'üé≤ Genera Nuova Saggezza';
            }
        }
        
        async function publishToSocial(wisdomId) {
            if (!confirm('Vuoi pubblicare questa saggezza sui social media?')) return;
            
            try {
                const response = await fetch(`/api/publish-social/${wisdomId}`, { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    showAlert('Pubblicazione sui social completata! üì±', 'success');
                } else {
                    showAlert('Errore nella pubblicazione sui social', 'error');
                }
            } catch (error) {
                showAlert('Errore: ' + error.message, 'error');
            }
        }
        
        async function runAutomation() {
            const button = event.target;
            button.disabled = true;
            button.textContent = '‚è≥ Eseguendo pipeline...';
            
            try {
                const response = await fetch('/api/automation/run-pipeline', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    showAlert('Pipeline automatica completata! ‚úÖ', 'success');
                } else {
                    showAlert('Errore nell\'esecuzione della pipeline', 'error');
                }
            } catch (error) {
                showAlert('Errore: ' + error.message, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'ü§ñ Esegui Pipeline Automatica';
            }
        }
        
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => alertDiv.remove(), 5000);
        }
        
        // Auto-refresh metriche ogni 60 secondi
        setInterval(async () => {
            try {
                const response = await fetch('/api/metrics/realtime');
                const metrics = await response.json();
                
                // Aggiorna elementi della pagina con nuove metriche
                updateMetricsDisplay(metrics);
            } catch (error) {
                console.log('Errore aggiornamento metriche:', error);
            }
        }, 60000);
        
        function updateMetricsDisplay(metrics) {
            // Trova e aggiorna gli elementi delle metriche
            const viewsElement = document.querySelector('[data-metric="views"]');
            const engagementElement = document.querySelector('[data-metric="engagement"]');
            
            if (viewsElement && metrics.views !== undefined) {
                viewsElement.textContent = metrics.views;
            }
            
            if (engagementElement && metrics.engagement_rate !== undefined) {
                engagementElement.textContent = (metrics.engagement_rate * 100).toFixed(1) + '%';
            }
        }
        
        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üêï Dashboard La Cuccia di Ugo caricato!');
            
            // Controlla stato sistema
            fetch('/api/system/status')
                .then(response => response.json())
                .then(status => {
                    if (status.status === 'healthy') {
                        console.log('‚úÖ Sistema operativo');
                    } else {
                        showAlert('‚ö†Ô∏è Alcuni componenti del sistema potrebbero non funzionare correttamente', 'warning');
                    }
                })
                .catch(error => {
                    showAlert('‚ùå Impossibile verificare lo stato del sistema', 'error');
                });
        });
    </script>
</body>
</html>
